
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Agent-driven interpretability experimentation framework with GPU cluster integration">
      
      
      
        <link rel="canonical" href="https://ajobi-uhc.github.io/seer/llm-context/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Seer Documentation - Seer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../overrides/assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#seer-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Seer" class="md-header__button md-logo" aria-label="Seer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Seer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Seer Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ajobi-uhc/seer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    seer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../concepts/overview/" class="md-tabs__link">
          
  
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../experiments/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/environment/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../development/contributing/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Seer" class="md-nav__button md-logo" aria-label="Seer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Seer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ajobi-uhc/seer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    seer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/scoped-sandbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scoped Sandbox & RPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/harness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/workspaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workspaces
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/01-sandbox-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Sandbox Intro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/02-scoped-sandbox-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Scoped Sandbox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/03-hidden-preference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Hidden Preference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/04-introspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Introspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/05-checkpoint-diffing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Checkpoint Diffing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiments/06-petri-harness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Petri Harness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/harness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harness API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/workspace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workspace API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why use it?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#when-to-use-seer" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to use Seer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-runs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example runs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-an-experiment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run an experiment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="seer-documentation">Seer Documentation</h1>
<h2 id="overview">Overview</h2>
<p>Seer is a framework for having agents conduct interpretability work and investigations. The core mechanism involves launching a remote sandbox hosted on a remote GPU or CPU. The agent operates an IPython kernel and notebook on this remote host.</p>
<h2 id="why-use-it">Why use it?</h2>
<p>This approach is valuable because it allows you to see what the agent is doing as it runs, and it can iteratively add things, fix bugs, and adjust its previous work. You can provide tooling to make an environment and any interpretability techniques available as function calls that the agent can use in the notebook as part of writing normal code.</p>
<h2 id="when-to-use-seer">When to use Seer</h2>
<ul>
<li><strong>Exploratory investigations</strong> where you have a hypothesis but want to try many variations quickly</li>
<li><strong>Scaling up</strong> measuring how well different interp techniques perform through giving agents controlled access to them</li>
<li><strong>Replicating known experiments</strong> on new models — the agent knows the recipe, you just point it at your model</li>
<li><strong>Building and improving existing agents</strong> Using seer to build better investigative agents, building better auditing agents etc.</li>
</ul>
<h2 id="example-runs">Example runs</h2>
<ul>
<li><a href="https://github.com/ajobi-uhc/seer/blob/main/example_runs/introspection_gemma_27b.ipynb">Replicate the key experiment in the Anthropic introspection paper on gemma3 27b</a></li>
<li><a href="https://github.com/ajobi-uhc/seer/blob/main/example_runs/find_hidden_gender_assumption.ipynb">Investigate a model finetuned with hidden preferences and discover them</a></li>
<li><a href="https://github.com/ajobi-uhc/seer/tree/main/example_runs/petri-style-transcripts">Create a hackable version of Petri for categorizing and finding weird behaviours</a></li>
<li><a href="https://github.com/ajobi-uhc/seer/blob/main/example_runs/checkpoint_diffing.ipynb">Use SAE techniques to diff two Gemini checkpoints and discover behavioral differences</a></li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li><a href="https://modal.com">Modal</a> account (GPU infrastructure)</li>
<li><a href="https://docs.astral.sh/uv/">uv</a> package manager</li>
</ul>
<h3 id="setup">Setup</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ajobi-uhc/seer
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>seer
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>uv<span class="w"> </span>sync
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>uv<span class="w"> </span>run<span class="w"> </span>modal<span class="w"> </span>token<span class="w"> </span>new
</code></pre></div>
<p>Create <code>.env</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nv">ANTHROPIC_API_KEY</span><span class="o">=</span>sk-ant-...
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nv">HF_TOKEN</span><span class="o">=</span>hf_...<span class="w">  </span><span class="c1"># Optional, for gated models</span>
</code></pre></div>
<h3 id="run-an-experiment">Run an experiment</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/hidden-preference-investigation
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<p><strong>What happens:</strong></p>
<ol>
<li>Modal provisions GPU (~30 sec)</li>
<li>Downloads models (cached for future runs)</li>
<li>Agent runs the experiment in a notebook</li>
<li>Results saved to <code>./outputs/</code></li>
</ol>
<p><strong>Costs:</strong> A100 ~$1-2/hour. Typical experiments 10-60 minutes.</p>
<h2 id="design-philosophy">Design Philosophy</h2>
<p>Seer tries not to be opinionated and is built to be hackable. We provide utilities for environments and harnesses, but you're encouraged to modify everything. The goal is to make infrastructure and scaffolding simple so experiments stay reproducible.</p>
<hr />
<h1 id="core-concepts">Core Concepts</h1>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>┌──────────────────────────────────────────────────────────────┐
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>│                         Your Machine                         │
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>│  ┌─────────────────────────────────────────────────────────┐ │
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>│  │                        Harness                          │ │
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>│  │  run_agent(prompt, mcp_config, provider=&quot;claude&quot;)       │ │
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>│  └───────────────────────────┬─────────────────────────────┘ │
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>│                              │ MCP                           │
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>│                              ▼                               │
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>│  ┌─────────────────────────────────────────────────────────┐ │
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>│  │                        Session                          │ │
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>│  │  Notebook: agent works in Jupyter                       │ │
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>│  │  Local: agent runs locally, calls GPU via RPC           │ │
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>│  └───────────────────────────┬─────────────────────────────┘ │
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>└──────────────────────────────┼───────────────────────────────┘
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>                               │
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>                               ▼
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>┌──────────────────────────────────────────────────────────────┐
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>│                      Modal (Remote GPU)                      │
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>│  ┌─────────────────────────────────────────────────────────┐ │
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>│  │                       Sandbox                           │ │
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>│  │  - GPU (A100, H100, etc.)                               │ │
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>│  │  - Models (cached on Modal volumes)                     │ │
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>│  │  - Workspace libraries                                  │ │
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>│  └─────────────────────────────────────────────────────────┘ │
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>└──────────────────────────────────────────────────────────────┘
</code></pre></div>
<h2 id="sandbox">Sandbox</h2>
<p>GPU environment with models loaded.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)],</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p>Two types:
- <strong>Sandbox</strong> — agent has full access
- <strong>ScopedSandbox</strong> — agent can only call functions you expose</p>
<h2 id="workspace">Workspace</h2>
<p>Any files/libraries the agent should have in its workspace.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;steering_hook.py&quot;</span><span class="p">),</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">])</span>
</code></pre></div>
<h2 id="session">Session</h2>
<p>How the agent connects to the sandbox.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>  <span class="c1"># Access via notebook</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># or</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_cli_session</span><span class="p">(</span><span class="n">workspace</span><span class="p">,</span> <span class="n">workspace_dir</span><span class="p">)</span>  <span class="c1"># Access via the cli</span>
</code></pre></div>
<h2 id="harness">Harness</h2>
<p>Runs the agent.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="k">pass</span>
</code></pre></div>
<h2 id="putting-it-together">Putting it together</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># 1. Sandbox</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span><span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># 2. Workspace</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># 3. Session</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># 4. Harness</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">):</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="k">pass</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="c1"># 5. Cleanup</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</code></pre></div>
<hr />
<h1 id="environment">Environment</h1>
<p>An environment is everything your agent needs to do its work: GPU compute, models, packages, files, and tools. Seer environments run on Modal, so you get on-demand GPUs without managing infrastructure.</p>
<p>You define what you need declaratively. Seer handles provisioning, model downloads, and caching.</p>
<h2 id="sandbox_1">Sandbox</h2>
<p>The sandbox is the running Modal container where your environment lives. Your agent runs locally and connects to the sandbox to execute code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)],</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;transformers&quot;</span><span class="p">],</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># ... agent works ...</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</code></pre></div>
<h2 id="config-options">Config options</h2>
<table>
<thead>
<tr>
<th>Field</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gpu</code></td>
<td>GPU type: "A100", "H100", or None for CPU</td>
</tr>
<tr>
<td><code>gpu_count</code></td>
<td>Number of GPUs (default: 1)</td>
</tr>
<tr>
<td><code>models</code></td>
<td>HuggingFace models to download</td>
</tr>
<tr>
<td><code>python_packages</code></td>
<td>pip packages to install</td>
</tr>
<tr>
<td><code>system_packages</code></td>
<td>apt packages to install</td>
</tr>
<tr>
<td><code>secrets</code></td>
<td>Env vars to pass from local .env</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>Sandbox timeout in seconds (default: 3600)</td>
</tr>
<tr>
<td><code>local_files</code></td>
<td>Files to mount: <code>[("./local.txt", "/sandbox/path.txt")]</code></td>
</tr>
<tr>
<td><code>local_dirs</code></td>
<td>Directories to mount: <code>[("./data", "/workspace/data")]</code></td>
</tr>
<tr>
<td><code>debug</code></td>
<td>Enable VS Code in browser</td>
</tr>
</tbody>
</table>
<h2 id="models">Models</h2>
<p>Models are downloaded to Modal volumes and cached across runs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">models</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">),</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-org/my-adapter&quot;</span><span class="p">,</span> <span class="n">is_peft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base_model</span><span class="o">=</span><span class="s2">&quot;meta-llama/Llama-2-7b&quot;</span><span class="p">),</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">]</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>ModelConfig field</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>HuggingFace model ID</td>
</tr>
<tr>
<td><code>var_name</code></td>
<td>Variable name in model info (default: "model")</td>
</tr>
<tr>
<td><code>hidden</code></td>
<td>Hide model details from agent</td>
</tr>
<tr>
<td><code>is_peft</code></td>
<td>Model is a PEFT/LoRA adapter</td>
</tr>
<tr>
<td><code>base_model</code></td>
<td>Base model ID (required if <code>is_peft=True</code>)</td>
</tr>
</tbody>
</table>
<h2 id="repos">Repos</h2>
<p>Clone git repos into the sandbox:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">repos</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="n">RepoConfig</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://github.com/org/repo&quot;</span><span class="p">),</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">RepoConfig</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;org/repo&quot;</span><span class="p">,</span> <span class="n">install</span><span class="o">=</span><span class="s2">&quot;pip install -e .&quot;</span><span class="p">),</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">]</span>
</code></pre></div>
<h2 id="working-with-a-running-sandbox">Working with a running sandbox</h2>
<p>Write files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s2">&quot;/workspace/config.json&quot;</span><span class="p">,</span> <span class="s1">&#39;{&quot;key&quot;: &quot;value&quot;}&#39;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">ensure_dir</span><span class="p">(</span><span class="s2">&quot;/workspace/outputs&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Run commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;pip install einops&quot;</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">exec_python</span><span class="p">(</span><span class="s2">&quot;print(torch.cuda.is_available())&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="snapshots">Snapshots</h2>
<p>Save sandbox state and restore it later:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">snapshot</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">snapshot</span><span class="p">(</span><span class="s2">&quot;after setup&quot;</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># Later...</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">new_sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="o">.</span><span class="n">from_snapshot</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>
<p>Useful for checkpointing long experiments or sharing reproducible starting points.</p>
<h2 id="sandbox-vs-scopedsandbox">Sandbox vs ScopedSandbox</h2>
<p><strong>Sandbox</strong> — agent has full notebook access, can run arbitrary code</p>
<p><strong>ScopedSandbox</strong> — agent can only call functions you expose via an interface file</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Full access</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># Scoped access</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">scoped</span> <span class="o">=</span> <span class="n">ScopedSandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">model_tools</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="s2">&quot;interface.py&quot;</span><span class="p">,</span> <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_session</span><span class="p">(</span><span class="n">workspace</span><span class="p">,</span> <span class="n">workspace_dir</span><span class="p">)</span>
</code></pre></div>
<h2 id="properties">Properties</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>What it returns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sandbox.jupyter_url</code></td>
<td>Jupyter URL (notebook mode)</td>
</tr>
<tr>
<td><code>sandbox.code_server_url</code></td>
<td>VS Code URL (debug mode)</td>
</tr>
<tr>
<td><code>sandbox.model_handles</code></td>
<td>Prepared model handles</td>
</tr>
<tr>
<td><code>sandbox.sandbox_id</code></td>
<td>Modal sandbox ID</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="scoped-sandbox-rpc">Scoped Sandbox &amp; RPC</h1>
<p>A <code>ScopedSandbox</code> serves specific GPU functions via RPC instead of giving the agent full access.</p>
<h2 id="when-to-use">When to use</h2>
<ul>
<li><strong>Sandbox</strong> — agent has full notebook access, good for exploration</li>
<li><strong>ScopedSandbox</strong> — agent can only call functions you expose, good for controlled experiments</li>
</ul>
<h2 id="writing-interface-files">Writing interface files</h2>
<p>An interface file defines what GPU functions the agent can call.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># interface.py</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoModel</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">model_path</span> <span class="o">=</span> <span class="n">get_model_path</span><span class="p">(</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)</span>  <span class="c1"># injected</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">device_map</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nd">@expose</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output_hidden_states</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="n">embedding</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">hidden_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="n">embedding</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
</code></pre></div>
<p>Rules:
- <code>@expose</code> marks functions the agent can call
- Must return JSON-serializable types (use <code>.tolist()</code> for tensors)
- <code>get_model_path()</code> is injected — returns cached model path
- Load models at module level, not inside functions</p>
<h2 id="serving-the-interface">Serving the interface</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">scoped</span> <span class="o">=</span> <span class="n">ScopedSandbox</span><span class="p">(</span><span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)],</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">model_tools</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="s2">&quot;interface.py&quot;</span><span class="p">,</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;mcp&quot;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_tools&quot;</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="p">)</span>
</code></pre></div>
<p><code>expose_as</code> options:
- <code>"library"</code> — agent imports it: <code>import model_tools</code>
- <code>"mcp"</code> — agent sees functions as MCP tools</p>
<h2 id="using-with-local-session">Using with local session</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="n">model_tools</span><span class="p">])</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_session</span><span class="p">(</span><span class="n">workspace</span><span class="p">,</span> <span class="n">workspace_dir</span><span class="p">)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="p">{}):</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="k">pass</span>
</code></pre></div>
<p>The agent runs locally. When it calls <code>model_tools.*</code>, the call goes to the GPU via RPC.</p>
<hr />
<h1 id="sessions">Sessions</h1>
<p>Sessions define how the agent connects to the sandbox.</p>
<table>
<thead>
<tr>
<th>Sandbox type</th>
<th>Session type</th>
<th>Agent experience</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Sandbox</code></td>
<td>Notebook</td>
<td>Full Jupyter access on GPU</td>
</tr>
<tr>
<td><code>ScopedSandbox</code></td>
<td>Local</td>
<td>Runs locally, calls exposed functions via RPC</td>
</tr>
</tbody>
</table>
<h2 id="notebook-session">Notebook session</h2>
<p>Agent gets a Jupyter notebook running on the sandbox.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>
</code></pre></div>
<p>Returns:
- <code>session.mcp_config</code> — pass to <code>run_agent</code>
- <code>session.jupyter_url</code> — view notebook in browser
- <code>session.model_info_text</code> — model details for agent prompt</p>
<p>Use when: exploratory research, iterative probing, visualization.</p>
<h2 id="local-session">Local session</h2>
<p>Agent runs on your machine. GPU access is through the functions you exposed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_session</span><span class="p">(</span><span class="n">workspace</span><span class="p">,</span> <span class="n">workspace_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
<p>Returns the same <code>mcp_config</code> interface, but execution happens locally.</p>
<p>Use when: controlled experiments, benchmarking specific functions, reproducibility.</p>
<p>Requires <code>ScopedSandbox</code> with interface file.</p>
<hr />
<h1 id="harness_1">Harness</h1>
<p>The harness runs the agent and connects it to a session. Seer provides a default harness, but it's designed to be swapped out. The session provides an mcp config for any harness/agent to connect to.</p>
<h2 id="basic-usage">Basic usage</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="n">prompt</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="p">):</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
<p>The harness:
1. Connects the agent to the session via MCP
2. Sends the prompt
3. Streams messages back
4. Handles tool calls automatically</p>
<h2 id="providers">Providers</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">provider</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span>   <span class="c1"># Claude (default)</span>
</code></pre></div>
<h2 id="interactive-mode">Interactive mode</h2>
<p>Chat with the agent in your terminal. Press ESC to interrupt mid-response.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">await</span> <span class="n">run_agent_interactive</span><span class="p">(</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="n">user_message</span><span class="o">=</span><span class="s2">&quot;Start by exploring the model&#39;s hidden preferences.&quot;</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">)</span>
</code></pre></div>
<h2 id="multi-agent">Multi-agent</h2>
<p>For multi-agent setups, run multiple agents with different (or the same!) configs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">auditor</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">auditor_prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="n">auditor_tools</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">investigator</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">investigator_prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="n">investigator_tools</span><span class="p">)</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">judge</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">judge_prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="p">{})</span>
</code></pre></div>
<h2 id="custom-harnesses">Custom harnesses</h2>
<p>The harness is just scaffolding around the agent. You can:</p>
<ul>
<li>Swap models (<code>model="claude-sonnet-4-5-20250929"</code>)</li>
<li>Add custom logging or callbacks</li>
<li>Build supervisor/worker patterns</li>
<li>Implement retries or error handling</li>
</ul>
<p>The session's <code>mcp_config</code> works with any agent framework that supports MCP.</p>
<hr />
<h1 id="workspaces">Workspaces</h1>
<p>A workspace defines everything the agent has access to: files, libraries, skills, and initialization code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">local_dirs</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;./data&quot;</span><span class="p">,</span> <span class="s2">&quot;/workspace/data&quot;</span><span class="p">)],</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;helpers.py&quot;</span><span class="p">)],</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">skill_dirs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./skills/research&quot;</span><span class="p">],</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">custom_init_code</span><span class="o">=</span><span class="s2">&quot;model = load_my_model()&quot;</span><span class="p">,</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="p">)</span>
</code></pre></div>
<h2 id="what-you-can-configure">What you can configure</h2>
<table>
<thead>
<tr>
<th>Field</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>local_dirs</code></td>
<td>Mount local directories into the workspace</td>
</tr>
<tr>
<td><code>local_files</code></td>
<td>Mount individual files</td>
</tr>
<tr>
<td><code>libraries</code></td>
<td>Python modules the agent can import</td>
</tr>
<tr>
<td><code>skill_dirs</code></td>
<td>Skill folders for agent discovery</td>
</tr>
<tr>
<td><code>custom_init_code</code></td>
<td>Python code to run at startup</td>
</tr>
<tr>
<td><code>preload_models</code></td>
<td>Whether to load models before agent starts (default: true)</td>
</tr>
<tr>
<td><code>hidden_model_loading</code></td>
<td>Hide model loading output from agent (default: true)</td>
</tr>
</tbody>
</table>
<h2 id="libraries">Libraries</h2>
<p>Make Python files importable by the agent:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;utils.py&quot;</span><span class="p">),</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_skill_dir</span><span class="p">(</span><span class="s2">&quot;skills/steering&quot;</span><span class="p">),</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="p">])</span>
</code></pre></div>
<p>When using <code>ScopedSandbox</code>, RPC handles are also libraries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">model_tools</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="s2">&quot;interface.py&quot;</span><span class="p">,</span> <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">)</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="n">model_tools</span><span class="p">])</span>
</code></pre></div>
<p>Either way, the agent just imports:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">my_helper</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">model_tools</span>
</code></pre></div>
<h2 id="skills">Skills</h2>
<p>Skill directories contain documentation and tools the agent can discover. Useful for giving the agent reference material or predefined procedures.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">skill_dirs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./skills/activation_patching&quot;</span><span class="p">])</span>
</code></pre></div>
<h2 id="custom-init-code">Custom init code</h2>
<p>Run arbitrary Python before the agent starts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="n">custom_init_code</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="s2">from transformers import AutoModel</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="s2">model = AutoModel.from_pretrained(&quot;google/gemma-2-9b&quot;)</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="s2">tokenizer = AutoTokenizer.from_pretrained(&quot;google/gemma-2-9b&quot;)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="p">)</span>
</code></pre></div>
<p>Variables defined here are available in the agent's namespace.</p>
<h2 id="seer-toolkit">Seer toolkit</h2>
<p>Common interpretability utilities live in <code>experiments/toolkit/</code>:</p>
<ul>
<li><code>extract_activations.py</code> — layer activation extraction</li>
<li><code>steering_hook.py</code> — activation steering via hooks</li>
<li><code>generate_response.py</code> — text generation helper</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">toolkit</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;experiments/toolkit&quot;</span><span class="p">)</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">toolkit</span> <span class="o">/</span> <span class="s2">&quot;steering_hook.py&quot;</span><span class="p">),</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">toolkit</span> <span class="o">/</span> <span class="s2">&quot;extract_activations.py&quot;</span><span class="p">),</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="p">])</span>
</code></pre></div>
<p>These are meant to be copied and modified.</p>
<hr />
<h1 id="experiments">Experiments</h1>
<h2 id="experiment-0-local-mode-no-modal">Experiment 0: Local Mode (No Modal)</h2>
<p>Run experiments locally without Modal signup or GPU. This will restrict you to mostly black box investigations.</p>
<h3 id="when-to-use-local-mode">When to use local mode</h3>
<p>Local mode is for experiments that don't need GPU:</p>
<ul>
<li><strong>API-based investigations</strong> - Probe models via OpenRouter, OpenAI, Anthropic APIs</li>
<li><strong>Testing and development</strong> - Iterate on prompts/tools before running on GPU</li>
<li><strong>CPU-only analysis</strong> - Data processing, visualization, lightweight inference</li>
</ul>
<p>For GPU workloads (loading large models locally), use the standard sandbox.</p>
<h3 id="prerequisites_1">Prerequisites</h3>
<ul>
<li>Repo cloned and <code>uv sync</code> completed</li>
<li><code>ANTHROPIC_API_KEY</code> in your <code>.env</code> file (for the agent)</li>
<li>Any other API keys your experiment needs (e.g., <code>OPENROUTER_API_KEY</code>)</li>
</ul>
<h3 id="quick-start_1">Quick start</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/api-kimi-investigation
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENROUTER_API_KEY</span><span class="o">=</span>your_key
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>main_local.py
</code></pre></div>
<p>That's it. No Modal signup, no GPU provisioning.</p>
<h3 id="how-it-works">How it works</h3>
<p>Instead of <code>Sandbox</code> + <code>create_notebook_session</code>, use <code>create_local_notebook_session</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_local_notebook_session</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workspace</span><span class="p">,</span> <span class="n">Library</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1"># Create local session (starts Jupyter locally)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_notebook_session</span><span class="p">(</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    <span class="n">workspace</span><span class="o">=</span><span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;my_tools.py&quot;</span><span class="p">)]),</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-experiment&quot;</span><span class="p">,</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="p">)</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="c1"># Same interface as remote sessions</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">)</span>  <span class="c1"># For agent connection</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;print(&#39;Hello!&#39;)&quot;</span><span class="p">)</span>  <span class="c1"># Execute code</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="n">session</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>  <span class="c1"># Cleanup</span>
</code></pre></div>
<h3 id="full-example-kimi-investigation">Full example: Kimi investigation</h3>
<p>This experiment uses Claude to investigate another model's (Kimi) behavior via API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># experiments/api-kimi-investigation/main_local.py</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workspace</span><span class="p">,</span> <span class="n">Library</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_local_notebook_session</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.harness</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_agent</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>    <span class="n">example_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="c1"># Workspace with OpenRouter client library</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>    <span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>        <span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">example_dir</span> <span class="o">/</span> <span class="s2">&quot;openrouter_client.py&quot;</span><span class="p">)]</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>    <span class="p">)</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>    <span class="c1"># Local session - no Modal needed</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">create_local_notebook_session</span><span class="p">(</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>        <span class="n">workspace</span><span class="o">=</span><span class="n">workspace</span><span class="p">,</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;kimi-investigation&quot;</span><span class="p">,</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>    <span class="p">)</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>    <span class="n">task</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="s2">    You are investigating the Kimi model&#39;s behavior on sensitive topics.</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="s2">    Use model &quot;moonshotai/kimi-k2-0905&quot; via openrouter_client.client.</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="s2">    Task: Investigate how the model responds to questions about</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="s2">    the 2024 Zhuhai car attack.</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>            <span class="n">prompt</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>            <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">,</span>
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>            <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">,</span>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a>        <span class="p">):</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>            <span class="k">pass</span>
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a>        <span class="n">session</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<p>The helper library (<code>openrouter_client.py</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAI</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://openrouter.ai/api/v1&quot;</span><span class="p">,</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPENROUTER_API_KEY&quot;</span><span class="p">),</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="p">)</span>
</code></pre></div>
<h3 id="whats-different-from-remote-mode">What's different from remote mode</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Local</th>
<th>Remote (Modal)</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPU access</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Model loading</td>
<td>Via API only</td>
<td>Local in sandbox</td>
</tr>
<tr>
<td>Startup time</td>
<td>~5 sec</td>
<td>~30 sec</td>
</tr>
<tr>
<td>Cost</td>
<td>Free (except API calls)</td>
<td>~$1-2/hour</td>
</tr>
<tr>
<td>Snapshots</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Isolation</td>
<td>Runs in your env</td>
<td>Sandboxed</td>
</tr>
</tbody>
</table>
<h3 id="api-compatibility">API compatibility</h3>
<p><code>LocalNotebookSession</code> has the same interface as <code>NotebookSession</code>:</p>
<ul>
<li><code>session.exec(code)</code> - Execute Python code</li>
<li><code>session.mcp_config</code> - MCP config for agents</li>
<li><code>session.workspace_path</code> - Where libraries are installed</li>
<li><code>session.terminate()</code> - Cleanup</li>
</ul>
<p>So you can often switch between local and remote by just changing the session creation.</p>
<hr />
<h2 id="experiment-1-sandbox-intro">Experiment 1: Sandbox Intro</h2>
<p>Spin up a GPU with a model and let an agent explore it in a Jupyter notebook.</p>
<h3 id="1-configure-the-sandbox">1. Configure the sandbox</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sandbox</span><span class="p">,</span> <span class="n">SandboxConfig</span><span class="p">,</span> <span class="n">ExecutionMode</span><span class="p">,</span> <span class="n">ModelConfig</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    <span class="n">execution_mode</span><span class="o">=</span><span class="n">ExecutionMode</span><span class="o">.</span><span class="n">NOTEBOOK</span><span class="p">,</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-2b-it&quot;</span><span class="p">)],</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;transformers&quot;</span><span class="p">,</span> <span class="s2">&quot;accelerate&quot;</span><span class="p">],</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="p">)</span>
</code></pre></div>
<ul>
<li><code>gpu</code> — A100 has 40GB VRAM, fits models up to ~30B params</li>
<li><code>execution_mode</code> — NOTEBOOK means agent works in Jupyter on the GPU</li>
<li><code>models</code> — HuggingFace model IDs to download and load</li>
<li><code>python_packages</code> — installed in the sandbox</li>
</ul>
<h3 id="2-start-the-sandbox">2. Start the sandbox</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p>Provisions the GPU on Modal. First run downloads the model (~2 min), subsequent runs use cache.</p>
<h3 id="3-create-a-workspace">3. Create a workspace</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workspace</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[])</span>
</code></pre></div>
<p>Workspace defines custom code the agent can import. Empty for now — later examples add interpretability tools here.</p>
<h3 id="4-create-a-session">4. Create a session</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_notebook_session</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>
</code></pre></div>
<p>Returns:
- <code>session.mcp_config</code> — config for agent to connect to the notebook
- <code>session.jupyter_url</code> — open this to watch the agent work
- <code>session.model_info_text</code> — model details to include in agent prompt</p>
<h3 id="5-run-the-agent">5. Run the agent</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.harness</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_agent</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">task</span> <span class="o">=</span> <span class="p">(</span><span class="n">example_dir</span> <span class="o">/</span> <span class="s2">&quot;task.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">model_info_text</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>    <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">,</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="p">):</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>    <span class="k">pass</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="n">sandbox</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</code></pre></div>
<p>The notebook saves to <code>./outputs/</code> as the agent works.</p>
<h3 id="full-example">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/sandbox-intro<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h2 id="experiment-2-scoped-sandbox">Experiment 2: Scoped Sandbox</h2>
<p>Give the agent access to specific GPU functions instead of a full notebook.</p>
<h3 id="when-to-use-this">When to use this</h3>
<ul>
<li><strong>Full sandbox</strong> (previous example) — agent has a notebook, can run arbitrary code, good for exploration</li>
<li><strong>Scoped sandbox</strong> — agent can only call functions you define, good when you want explicit control</li>
</ul>
<h3 id="1-configure-the-scoped-sandbox">1. Configure the scoped sandbox</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScopedSandbox</span><span class="p">,</span> <span class="n">SandboxConfig</span><span class="p">,</span> <span class="n">ModelConfig</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">scoped</span> <span class="o">=</span> <span class="n">ScopedSandbox</span><span class="p">(</span><span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)],</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;transformers&quot;</span><span class="p">,</span> <span class="s2">&quot;accelerate&quot;</span><span class="p">],</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="p">))</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="n">scoped</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p>No <code>execution_mode</code> — the agent doesn't run in the sandbox. Instead, you serve specific functions from it.</p>
<h3 id="2-define-gpu-functions">2. Define GPU functions</h3>
<p>Create an interface file with functions that run on the GPU:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># interface.py</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoModel</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">model_path</span> <span class="o">=</span> <span class="n">get_model_path</span><span class="p">(</span><span class="s2">&quot;google/gemma-2-9b&quot;</span><span class="p">)</span>  <span class="c1"># injected by RPC server</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">device_map</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="nd">@expose</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get basic model information.&quot;&quot;&quot;</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>        <span class="s2">&quot;num_layers&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span><span class="p">,</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>        <span class="s2">&quot;hidden_size&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>        <span class="s2">&quot;vocab_size&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>    <span class="p">}</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="nd">@expose</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get text embedding from model.&quot;&quot;&quot;</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">output_hidden_states</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>    <span class="n">embedding</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">hidden_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="n">embedding</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
</code></pre></div>
<ul>
<li><code>@expose</code> marks functions the agent can call — everything else is hidden</li>
<li>Functions must return JSON-serializable types (use <code>.tolist()</code> for tensors)</li>
<li><code>get_model_path()</code> is injected — returns the cached model path</li>
</ul>
<h3 id="3-serve-the-interface">3. Serve the interface</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">model_tools</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>    <span class="nb">str</span><span class="p">(</span><span class="n">example_dir</span> <span class="o">/</span> <span class="s2">&quot;interface.py&quot;</span><span class="p">),</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>    <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">,</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_tools&quot;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="p">)</span>
</code></pre></div>
<p>Loads <code>interface.py</code> on the GPU and creates an RPC server.</p>
<p><code>expose_as</code> options:
- <code>"library"</code> — agent imports it: <code>import model_tools; model_tools.get_embedding("hello")</code>
- <code>"mcp"</code> — agent sees them as MCP tools</p>
<h3 id="full-example_1">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/scoped-sandbox-intro<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h2 id="experiment-3-hidden-preference-investigation">Experiment 3: Hidden Preference Investigation</h2>
<p>Investigate a fine-tuned model for hidden biases using interpretability tools.</p>
<p>This builds on Sandbox Intro by adding interpretability libraries to the workspace.</p>
<h3 id="1-configure-with-peft-model">1. Configure with PEFT model</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sandbox</span><span class="p">,</span> <span class="n">SandboxConfig</span><span class="p">,</span> <span class="n">ExecutionMode</span><span class="p">,</span> <span class="n">ModelConfig</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;A100&quot;</span><span class="p">,</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>    <span class="n">execution_mode</span><span class="o">=</span><span class="n">ExecutionMode</span><span class="o">.</span><span class="n">NOTEBOOK</span><span class="p">,</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bcywinski/gemma-2-9b-it-user-female&quot;</span><span class="p">,</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>        <span class="n">base_model</span><span class="o">=</span><span class="s2">&quot;google/gemma-2-9b-it&quot;</span><span class="p">,</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>        <span class="n">is_peft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>        <span class="n">hidden</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    <span class="p">)],</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;transformers&quot;</span><span class="p">,</span> <span class="s2">&quot;accelerate&quot;</span><span class="p">,</span> <span class="s2">&quot;datasets&quot;</span><span class="p">,</span> <span class="s2">&quot;peft&quot;</span><span class="p">],</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>    <span class="n">secrets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;huggingface-secret&quot;</span><span class="p">],</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="p">)</span>
</code></pre></div>
<p>New <code>ModelConfig</code> parameters:
- <code>base_model</code> — base model to load first
- <code>is_peft=True</code> — this is a PEFT adapter (LoRA, etc.), not a full model
- <code>hidden=True</code> — hides model name from agent to prevent bias in investigation</p>
<h3 id="2-add-interpretability-libraries">2. Add interpretability libraries</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workspace</span><span class="p">,</span> <span class="n">Library</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="n">toolkit</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;toolkit&quot;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">toolkit</span> <span class="o">/</span> <span class="s2">&quot;steering_hook.py&quot;</span><span class="p">),</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">toolkit</span> <span class="o">/</span> <span class="s2">&quot;extract_activations.py&quot;</span><span class="p">),</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="p">])</span>
</code></pre></div>
<p>These are in <code>experiments/toolkit/</code>:</p>
<ul>
<li><code>extract_activations.py</code> — extract activations at any layer/position</li>
<li><code>steering_hook.py</code> — inject vectors during generation</li>
</ul>
<p>The agent can then:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">extract_activations</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_activation</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">steering_hook</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_steering_hook</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="c1"># Extract activations for two inputs</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="n">act1</span> <span class="o">=</span> <span class="n">extract_activation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="s2">&quot;neutral text&quot;</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="n">act2</span> <span class="o">=</span> <span class="n">extract_activation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="s2">&quot;biased text&quot;</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="c1"># Compute steering vector</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="n">steering_vec</span> <span class="o">=</span> <span class="n">act2</span> <span class="o">-</span> <span class="n">act1</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="c1"># Test if it causally affects behavior</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="k">with</span> <span class="n">create_steering_hook</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">layer_idx</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">steering_vec</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h3 id="full-example_2">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/hidden-preference-investigation<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h2 id="experiment-4-introspection">Experiment 4: Introspection</h2>
<p>Replicate the Anthropic introspection experiment: can a model detect which concept is being injected into its activations?</p>
<p>This uses the same setup as Hidden Preference — notebook mode with steering libraries.</p>
<h3 id="the-experiment">The experiment</h3>
<ol>
<li>Extract concept vectors (e.g., "Lightning", "Oceans", "Happiness") by computing <code>activation(concept) - mean(activation(baselines))</code></li>
<li>Inject these vectors during generation while asking the model "Do you detect an injected thought? What is it about?"</li>
<li>Score whether the model correctly identifies the injected concept</li>
<li>Compare against control trials (no injection) to establish baseline</li>
</ol>
<h3 id="setup_1">Setup</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>    <span class="n">gpu</span><span class="o">=</span><span class="s2">&quot;H100&quot;</span><span class="p">,</span>  <span class="c1"># Larger model needs more VRAM</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>    <span class="n">execution_mode</span><span class="o">=</span><span class="n">ExecutionMode</span><span class="o">.</span><span class="n">NOTEBOOK</span><span class="p">,</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">)],</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;transformers&quot;</span><span class="p">,</span> <span class="s2">&quot;accelerate&quot;</span><span class="p">,</span> <span class="s2">&quot;pandas&quot;</span><span class="p">,</span> <span class="s2">&quot;matplotlib&quot;</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">],</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="p">)</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">shared_libs</span> <span class="o">/</span> <span class="s2">&quot;steering_hook.py&quot;</span><span class="p">),</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>    <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">shared_libs</span> <span class="o">/</span> <span class="s2">&quot;extract_activations.py&quot;</span><span class="p">),</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="p">])</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span><span class="n">sandbox</span><span class="p">,</span> <span class="n">workspace</span><span class="p">)</span>
</code></pre></div>
<h3 id="what-the-agent-does">What the agent does</h3>
<p>The task prompt guides the agent through:</p>
<ol>
<li>Extracting concept vectors at ~70% model depth</li>
<li>Verifying steering works on neutral prompts</li>
<li>Running injection trials with the introspection prompt</li>
<li>Running control trials without injection</li>
<li>Computing identification rates and comparing against baseline</li>
</ol>
<h3 id="full-example_3">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/introspection<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h2 id="experiment-5-checkpoint-diffing">Experiment 5: Checkpoint Diffing</h2>
<p>Compare two model checkpoints (Gemini 2.0 vs 2.5 Flash) using SAE-based analysis to find behavioral differences.</p>
<p>This introduces new config options: cloning external repos and accessing external APIs.</p>
<h3 id="new-concepts">New concepts</h3>
<h4 id="cloning-external-repos">Cloning external repos</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">RepoConfig</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="n">repos</span><span class="o">=</span><span class="p">[</span><span class="n">RepoConfig</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;nickjiang2378/interp_embed&quot;</span><span class="p">)],</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    <span class="c1"># ...</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="p">)</span>
</code></pre></div>
<p>The repo is cloned to <code>/workspace/interp_embed</code> in the sandbox. The agent can import from it.</p>
<h4 id="external-api-access">External API access</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>    <span class="n">secrets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GEMINI_API_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;OPENAI_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;OPENROUTER_API_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;HF_TOKEN&quot;</span><span class="p">],</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>    <span class="c1"># ...</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="p">)</span>
</code></pre></div>
<p>Secrets are Modal secrets you've configured. They're available as environment variables in the sandbox.</p>
<h4 id="longer-timeout">Longer timeout</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>    <span class="n">timeout</span><span class="o">=</span><span class="mi">7200</span><span class="p">,</span>  <span class="c1"># 2 hours (default is 1 hour)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>    <span class="c1"># ...</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">)</span>
</code></pre></div>
<p>SAE encoding is slow — this experiment can take 1-2 hours.</p>
<h3 id="what-the-agent-does_1">What the agent does</h3>
<ol>
<li>Generate prompts designed to reveal behavioral differences</li>
<li>Collect responses from both Gemini versions via OpenRouter</li>
<li>Encode responses using SAE (Llama 3.1 8B SAE with 65k features)</li>
<li>Diff feature activations to find what changed between versions</li>
<li>Analyze top differentiating features with examples</li>
</ol>
<h3 id="full-example_4">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/checkpoint-diffing<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h2 id="experiment-6-petri-style-harness">Experiment 6: Petri-Style Harness</h2>
<p>A hackable version of Petri for categorizing and finding weird behaviors in models.</p>
<p>This shows how to build multi-agent auditing pipelines with Seer.</p>
<h3 id="architecture">Architecture</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Phase 1: Audit
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>┌──────────┐      MCP tools      ┌─────────────────────┐
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>│ Auditor  │ ──────────────────► │   Scoped Sandbox    │
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>│ (Claude) │                     │                     │
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>│          │ ◄────responses───── │  Target (via API)   │
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>└──────────┘                     └─────────────────────┘
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>Phase 2: Judge
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>┌──────────┐
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>│  Judge   │ ◄── transcript retrieved from sandbox
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>│ (Claude) │
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>└──────────┘
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>     │
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>     ▼
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>   scores
</code></pre></div>
<ol>
<li><strong>Auditor</strong> probes the Target via MCP tools exposed from the sandbox</li>
<li><strong>Transcript</strong> is retrieved after the audit completes</li>
<li><strong>Judge</strong> scores the transcript on multiple dimensions</li>
</ol>
<h3 id="new-concepts_1">New concepts</h3>
<h4 id="scoped-sandbox-exposing-mcp-tools">Scoped sandbox exposing MCP tools</h4>
<p>Use <code>expose_as="mcp"</code> so the agent gets tools instead of importable functions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">scoped</span> <span class="o">=</span> <span class="n">ScopedSandbox</span><span class="p">(</span><span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>    <span class="n">gpu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># No GPU — using OpenRouter API</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>    <span class="n">python_packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;openai&quot;</span><span class="p">],</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>    <span class="n">secrets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OPENROUTER_API_KEY&quot;</span><span class="p">],</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="p">))</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">scoped</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">mcp_config</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>    <span class="s2">&quot;conversation_interface.py&quot;</span><span class="p">,</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>    <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;mcp&quot;</span><span class="p">,</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;petri_tools&quot;</span>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="p">)</span>
</code></pre></div>
<p>The Auditor sees tools like <code>send_message()</code>, <code>get_transcript()</code> in its tool list.</p>
<h4 id="no-gpu">No GPU</h4>
<p>The Target model runs via API, so no GPU needed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">SandboxConfig</span><span class="p">(</span><span class="n">gpu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h4 id="sequential-agents">Sequential agents</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># Phase 1: Auditor uses MCP tools to probe Target</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span><span class="n">auditor_prompt</span><span class="p">,</span> <span class="n">mcp_config</span><span class="o">=</span><span class="n">mcp_config</span><span class="p">):</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>    <span class="k">pass</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="c1"># Phase 2: Retrieve transcript</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="n">transcript</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;cat /tmp/petri_transcript.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="c1"># Phase 3: Judge scores (simple API call, no tools)</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="n">judge_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-sonnet-4-5-20250929&quot;</span><span class="p">,</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">build_judge_prompt</span><span class="p">(</span><span class="n">transcript</span><span class="p">)}],</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="p">)</span>
</code></pre></div>
<h3 id="conversation-interface">Conversation interface</h3>
<p><code>conversation_interface.py</code> exposes these MCP tools:</p>
<ul>
<li><code>set_system_prompt(prompt)</code> — configure Target's system prompt</li>
<li><code>send_message(content)</code> — send user message to Target</li>
<li><code>get_response()</code> — get Target's last response</li>
<li><code>get_transcript()</code> — save and return full conversation</li>
<li><code>reset_conversation()</code> — start over</li>
</ul>
<h3 id="full-example_5">Full example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nb">cd</span><span class="w"> </span>experiments/petri-style-harness<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>main.py
</code></pre></div>
<hr />
<h1 id="api-reference">API Reference</h1>
<h2 id="environment-api">Environment API</h2>
<h3 id="sandboxconfig">SandboxConfig</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">SandboxConfig</span><span class="p">(</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>    <span class="n">gpu</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                    <span class="c1"># &quot;A100&quot;, &quot;H100&quot;, &quot;A10G&quot;, or None for CPU</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>    <span class="n">gpu_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>                 <span class="c1"># Number of GPUs</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>    <span class="n">execution_mode</span><span class="p">:</span> <span class="n">ExecutionMode</span> <span class="o">=</span> <span class="n">ExecutionMode</span><span class="o">.</span><span class="n">CLI</span><span class="p">,</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>    <span class="n">models</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ModelConfig</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    <span class="n">repos</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RepoConfig</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>    <span class="n">python_packages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>    <span class="n">system_packages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>    <span class="n">secrets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>            <span class="c1"># Modal secret names</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>                <span class="c1"># Seconds (default 1 hour)</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>    <span class="n">local_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>      <span class="c1"># [(local_path, sandbox_path), ...]</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>    <span class="n">local_dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>       <span class="c1"># [(local_path, sandbox_path), ...]</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>    <span class="n">env</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>           <span class="c1"># Environment variables</span>
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                <span class="c1"># Enable VS Code in browser</span>
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="p">)</span>
</code></pre></div>
<h3 id="modelconfig">ModelConfig</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">ModelConfig</span><span class="p">(</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>                          <span class="c1"># HuggingFace model ID</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>    <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span>            <span class="c1"># Variable name in model info</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>    <span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>               <span class="c1"># Hide model name from agent</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>    <span class="n">is_peft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>              <span class="c1"># Is a PEFT adapter</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>    <span class="n">base_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>             <span class="c1"># Base model ID if PEFT</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="p">)</span>
</code></pre></div>
<h3 id="repoconfig">RepoConfig</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">RepoConfig</span><span class="p">(</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>                           <span class="c1"># GitHub repo (e.g., &quot;user/repo&quot;)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>    <span class="n">dockerfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>             <span class="c1"># Optional Dockerfile path</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>    <span class="n">install</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                <span class="c1"># Install command (e.g., &quot;pip install -e .&quot;)</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="p">)</span>
</code></pre></div>
<h3 id="executionmode">ExecutionMode</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">ExecutionMode</span><span class="o">.</span><span class="n">NOTEBOOK</span>  <span class="c1"># Jupyter notebook on GPU</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">ExecutionMode</span><span class="o">.</span><span class="n">CLI</span>       <span class="c1"># Shell interface</span>
</code></pre></div>
<h3 id="sandbox_2">Sandbox</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p><strong>Methods:</strong></p>
<ul>
<li><code>start()</code> → Sandbox — provision GPU, download models, return running sandbox</li>
<li><code>terminate()</code> — shutdown sandbox</li>
<li><code>exec(cmd: str)</code> → str — execute shell command</li>
<li><code>exec_python(code: str)</code> → str — execute Python code</li>
<li><code>write_file(path: str, content: str)</code> — write file to sandbox</li>
<li><code>ensure_dir(path: str)</code> — create directory in sandbox</li>
<li><code>snapshot(name: str)</code> — save sandbox state</li>
</ul>
<p><strong>Properties:</strong></p>
<ul>
<li><code>jupyter_url</code> — Jupyter URL (notebook mode)</li>
<li><code>code_server_url</code> — VS Code URL (debug mode)</li>
<li><code>model_handles</code> — list of ModelHandle for loaded models</li>
<li><code>repo_handles</code> — list of RepoHandle for cloned repos</li>
<li><code>sandbox_id</code> — Modal sandbox ID</li>
</ul>
<h3 id="scopedsandbox">ScopedSandbox</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">scoped</span> <span class="o">=</span> <span class="n">ScopedSandbox</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">scoped</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>    <span class="s2">&quot;interface.py&quot;</span><span class="p">,</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>    <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;mcp&quot;</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;model_tools&quot;</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="p">)</span>
</code></pre></div>
<p><strong>Methods:</strong></p>
<ul>
<li><code>start()</code> — provision sandbox</li>
<li><code>serve(file, expose_as, name)</code> → Library | dict — serve file as RPC library or MCP tools</li>
<li><code>write_file(path, content)</code> — write file to sandbox</li>
<li><code>exec(cmd)</code> → str — execute shell command</li>
<li><code>terminate()</code> — shutdown sandbox</li>
</ul>
<p><strong>expose_as options:</strong></p>
<ul>
<li><code>"library"</code> — returns Library, agent imports it</li>
<li><code>"mcp"</code> — returns MCP config dict, agent sees tools</li>
</ul>
<p><strong>Snapshots:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># Save state</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="n">snapshot</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">snapshot</span><span class="p">(</span><span class="s2">&quot;after setup&quot;</span><span class="p">)</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="c1"># Restore later</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="n">new_sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="o">.</span><span class="n">from_snapshot</span><span class="p">(</span><span class="n">snapshot</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="workspace-api">Workspace API</h2>
<h3 id="workspace_1">Workspace</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">Workspace</span><span class="p">(</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>    <span class="n">libraries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Library</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>    <span class="n">skills</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Skill</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>    <span class="n">skill_dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>    <span class="n">local_dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>       <span class="c1"># [(src_path, dest_path), ...]</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>    <span class="n">local_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>    <span class="n">custom_init_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>    <span class="n">preload_models</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>        <span class="c1"># Load models before agent starts</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>    <span class="n">hidden_model_loading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Hide model loading from agent</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="p">)</span>
</code></pre></div>
<p><strong>Methods:</strong></p>
<ul>
<li><code>get_library_docs()</code> → str — combined docs for all libraries (for agent prompt)</li>
</ul>
<h3 id="library">Library</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># From local file</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;helpers.py&quot;</span><span class="p">)</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="c1"># From code string</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="s2">&quot;utils&quot;</span><span class="p">,</span> <span class="s2">&quot;def foo(): ...&quot;</span><span class="p">)</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="c1"># From skill directory</span>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">from_skill_dir</span><span class="p">(</span><span class="s2">&quot;skills/steering&quot;</span><span class="p">)</span>
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="c1"># From ScopedSandbox (RPC)</span>
<a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">scoped</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="s2">&quot;interface.py&quot;</span><span class="p">,</span> <span class="n">expose_as</span><span class="o">=</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;tools&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Methods:</strong></p>
<ul>
<li><code>Library.from_file(path)</code> → Library</li>
<li><code>Library.from_code(name, code)</code> → Library</li>
<li><code>Library.from_skill_dir(path)</code> → Library</li>
<li><code>get_prompt_docs()</code> → str — documentation for agent</li>
</ul>
<h3 id="skill">Skill</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># From directory with SKILL.md</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="s2">&quot;skills/steering&quot;</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="c1"># From function with @expose decorator</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="nd">@expose</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_activation</span><span class="p">(</span><span class="o">...</span><span class="p">):</span> <span class="o">...</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span><span class="n">extract_activation</span><span class="p">)</span>
</code></pre></div>
<p>Skills are discovered by Claude Code and shown in agent's skill list.</p>
<hr />
<h2 id="execution-api">Execution API</h2>
<h3 id="create_notebook_session">create_notebook_session</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_notebook_session</span><span class="p">(</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>    <span class="n">sandbox</span><span class="p">:</span> <span class="n">Sandbox</span><span class="p">,</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>    <span class="n">workspace</span><span class="p">:</span> <span class="n">Workspace</span><span class="p">,</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;notebook&quot;</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="p">)</span>
</code></pre></div>
<p>Agent gets Jupyter notebook on GPU.</p>
<p><strong>Returns NotebookSession:</strong></p>
<ul>
<li><code>mcp_config</code> — pass to run_agent</li>
<li><code>jupyter_url</code> — view notebook in browser</li>
<li><code>model_info_text</code> — model details for prompt</li>
<li><code>session_id</code> — unique identifier</li>
<li><code>workspace_path</code> — path to workspace in sandbox</li>
<li><code>exec(code)</code> — execute Python in notebook</li>
<li><code>terminate()</code> — shutdown session</li>
</ul>
<h3 id="create_local_session">create_local_session</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_session</span><span class="p">(</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>    <span class="n">workspace</span><span class="p">:</span> <span class="n">Workspace</span><span class="p">,</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>    <span class="n">workspace_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="p">)</span>
</code></pre></div>
<p>Agent runs locally. Use with ScopedSandbox for GPU access via RPC.</p>
<p><strong>Returns LocalSession:</strong></p>
<ul>
<li><code>mcp_config</code> — pass to run_agent (empty dict)</li>
<li><code>name</code> — session name</li>
<li><code>workspace_dir</code> — local workspace path</li>
</ul>
<h3 id="create_local_notebook_session">create_local_notebook_session</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_local_notebook_session</span><span class="p">(</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>    <span class="n">workspace</span><span class="p">:</span> <span class="n">Workspace</span><span class="p">,</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;notebook&quot;</span><span class="p">,</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./outputs&quot;</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="p">)</span>
</code></pre></div>
<p>Agent gets Jupyter notebook running locally (no Modal needed).</p>
<p><strong>Returns LocalNotebookSession:</strong></p>
<ul>
<li><code>mcp_config</code> — pass to run_agent</li>
<li><code>jupyter_url</code> — view notebook in browser</li>
<li><code>notebook_path</code> — path to saved notebook</li>
<li><code>workspace_path</code> — path to workspace</li>
<li><code>exec(code)</code> — execute Python in notebook</li>
<li><code>terminate()</code> — shutdown session</li>
</ul>
<h3 id="create_cli_session">create_cli_session</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">session</span> <span class="o">=</span> <span class="n">create_cli_session</span><span class="p">(</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>    <span class="n">sandbox</span><span class="p">:</span> <span class="n">Sandbox</span><span class="p">,</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>    <span class="n">workspace</span><span class="p">:</span> <span class="n">Workspace</span><span class="p">,</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cli&quot;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="p">)</span>
</code></pre></div>
<p>Agent gets shell interface to sandbox.</p>
<p><strong>Returns CLISession:</strong></p>
<ul>
<li><code>mcp_config</code> — pass to run_agent</li>
<li><code>session_id</code> — unique identifier</li>
<li><code>exec(code)</code> — execute Python in sandbox</li>
<li><code>exec_shell(cmd)</code> — execute shell command</li>
</ul>
<hr />
<h2 id="harness-api">Harness API</h2>
<h3 id="run_agent">run_agent</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>    <span class="n">mcp_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;claude&quot;</span><span class="p">,</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>    <span class="n">user_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="p">):</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
<p>Run agent with task prompt. Streams messages.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>prompt</code> — system prompt / task description</li>
<li><code>mcp_config</code> — from session (or empty dict)</li>
<li><code>provider</code> — "claude" (default)</li>
<li><code>model</code> — specific model (optional, defaults to claude-sonnet-4-5-20250929)</li>
<li><code>user_message</code> — initial user message (optional)</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">run_agent</span><span class="p">(</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Explore this model&#39;s behavior&quot;</span><span class="p">,</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>    <span class="n">mcp_config</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">mcp_config</span><span class="p">,</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="p">):</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="run_agent_interactive">run_agent_interactive</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">await</span> <span class="n">run_agent_interactive</span><span class="p">(</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>    <span class="n">mcp_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>    <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;claude&quot;</span><span class="p">,</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>    <span class="n">user_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="p">)</span>
</code></pre></div>
<p>Interactive chat session with agent. For debugging or manual exploration. Press ESC to interrupt mid-response.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>prompt</code> — optional system prompt</li>
<li><code>mcp_config</code> — from session (or empty dict)</li>
<li><code>provider</code> — "claude" (default)</li>
<li><code>model</code> — specific model (optional)</li>
<li><code>user_message</code> — initial message to start conversation</li>
</ul>
<hr />
<h1 id="additional-resources">Additional Resources</h1>
<ul>
<li>GitHub: https://github.com/ajobi-uhc/seer</li>
<li>Example Notebooks: https://github.com/ajobi-uhc/seer/tree/main/example_runs</li>
<li>Modal: https://modal.com</li>
<li>Documentation: https://ajobi-uhc.github.io/seer/</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>